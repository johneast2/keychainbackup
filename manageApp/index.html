<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css" integrity="sha384-TX8t27EcRE3e/ihU7zmQxVncDAy5uIKz4rEkgIXeMed4M0jlfIDPvg6uqKI2xXr2" crossorigin="anonymous">
<script>window.$ = window.jQuery = require('jquery');</script>
    <title>Keychain Backup Device Manager</title>
</head>

<body>
    <div id="setupDeviceDiv">
    <h1>Keychain Backup Device Manager</h1>
        <div id="setupformDiv">
    	<div id="ipAddressErrorMessage">
    	</div>
        Omega2 ip address:
        <input type="text" maxlength="3" size="3" id="octetA"></input>.<input type="text" maxlength="3"size="3" id="octetB"></input>.<input type="text" maxlength="3"size="3" id="octetC"></input>.<input type="text" maxlength="3"size="3" id="octetD"></input><br>
        Omega2 ssh Password:<input type="text" id="sshPassword" placeholder="leave blank to not change"></input><br>
	<div id="encryptedErrorMessage">
    	</div>
	Encrypted Container Password:<input type="text" id="encPassword"></input><br>
	<button type="button" class="btn btn-primary" id="setupDeviceButton">
	    Setup Device
	</button>
        </div>
     </div>
     <div id="confirmDelete">
        <H1>!! WARNING !!</H1><br>
        This setup process will delete all files on the usb drive.<br><br>
        <button type="button" class="btn btn-warning" id="confirmSetupDeviceButton">
	    I understand that all files will be erased!<br><br>Click here to continue with setup
	</button>
     </div>
     <div id="setupStatusDiv">
         <h1>Connecting to device...</h1>
     </div>
</body>

<script>

document.addEventListener("DOMContentLoaded", function(){
	$('#setupStatusDiv').hide();
	$('#confirmDelete').hide();
});

const { ipcRenderer } = require('electron');

$("#setupDeviceButton").on('click', () => {
	$('#setupformDiv').hide();
	$('#confirmDelete').show();


});

$("#confirmSetupDeviceButton").on('click', () => {
    var setupArgs = {};
    setupArgs["octetA"] = $("#octetA").val();
    setupArgs["octetB"] = $("#octetB").val();
    setupArgs["octetC"] = $("#octetC").val();
    setupArgs["octetD"] = $("#octetD").val();
    setupArgs["sshPassword"] = $("#sshPassword").val();
    setupArgs["encPassword"] = $("#encPassword").val();

    $('#confirmDelete').hide();

    var result = ipcRenderer.sendSync('setupDevice', setupArgs);

    console.log("result = " + result);
	if (result["validIpAddress"] === false)
	{
		$('#ipAddressErrorMessage').css('background-color', 'OrangeRed');
		$('#ipAddressErrorMessage').html("Invalid IP Address for device!");
		$('#ipAddressErrorMessage').show();
		$('#setupformDiv').show();
	}
	else 
	{
		$('#ipAddressErrorMessage').hide();
	}
	if (result["validEncPassword"] === false)
	{
		$('#encryptedErrorMessage').css('background-color', 'OrangeRed');
		$('#encryptedErrorMessage').html("Encrypted Container Password cannot be empty!");
		$('#encryptedErrorMessage').show();
                $('#setupformDiv').show();
	}
	else
	{
		$('#encryptedErrorMessage').hide();
                $('#setupformDiv').hide();
	}
});

ipcRenderer.on('async-status', (event, arg) => {
    $('#setupformDiv').hide();

    $('#setupStatusDiv').html("<h1>" + arg + "</H1>");

    $('#setupStatusDiv').show();
})
</script>
</html>
